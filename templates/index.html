<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Profiles</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <h1>ðŸ“š Student Profiles</h1>
            <p>Manage and upload profile photos for students with ease.</p>
        </div>
    </header>

    <!-- Page Container -->
    <div class="page-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>Students</h2>
            <ul id="studentList">
                <script>
                    const students = [
                        { id: 1, name: "Alice Johnson" },
                        { id: 2, name: "Bob Smith" },
                        { id: 3, name: "Charlie Brown" },
                        { id: 4, name: "David Wilson" },
                        { id: 5, name: "Ella Davis" },
                        { id: 6, name: "Frank Miller" },
                        { id: 7, name: "Grace Taylor" }
                    ];

                    students.forEach(student => {
                        document.write(`<li onclick="showStudentDetails(${student.id})">${student.name}</li>`);
                    });
                </script>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="content">
            <div id="studentProfile" class="profile-card">
                <div class="profile-image">
                    <img id="profileImage" src="https://via.placeholder.com/200" alt="Profile Photo">
                </div>
                <div class="profile-info">
                    <h2 id="studentName"></h2>
                    <p>Select a photo to upload for this student:</p>
                    <input type="file" id="fileInput" />
                    <button onclick="uploadFile()">Upload Photo</button>
                    <p id="status" class="status"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2024 Student Management System | All Rights Reserved</p>
    </footer>

    <script>
        let selectedStudentId = null;

        // Show the first student's details on page load
        window.onload = () => {
            showStudentDetails(students[0].id);
        };

        function showStudentDetails(studentId) {
            const student = students.find(s => s.id === studentId);
            if (student) {
                document.getElementById("studentName").innerText = student.name;
                document.getElementById("profileImage").src = "https://via.placeholder.com/200";
                selectedStudentId = student.id;

                document.getElementById("studentProfile").classList.remove("hidden");
                document.getElementById("status").innerText = "";
            }
        }

        async function uploadFile() {
            const fileInput = document.getElementById("fileInput");
            const status = document.getElementById("status");
            const file = fileInput.files[0];

            if (!file) {
                alert("Please select a file!");
                return;
            }

            status.innerText = "Uploading...";
            status.style.color = "#F39C12";

            try {
                // Step 1: Generate Pre-signed URL
                const response = await fetch("/generate-url", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        student_name: students.find(s => s.id === selectedStudentId).name,
                        file_name: file.name,
                        file_type: file.type
                    })
                });

                const data = await response.json();

                if (!data.url) {
                    throw new Error("Failed to get pre-signed URL!");
                }

                // Step 2: Upload File to S3
                const upload = await fetch(data.url, {
                    method: "PUT",
                    body: file,
                    headers: { "Content-Type": file.type }
                });

                if (upload.ok) {
                    status.innerText = "Photo uploaded successfully!";
                    status.style.color = "#27AE60";
                    document.getElementById("profileImage").src = data.url.split("?")[0];
                } else {
                    throw new Error("Upload failed!");
                }
            } catch (error) {
                console.error("Error:", error);
                status.innerText = "Upload failed!";
                status.style.color = "#E74C3C";
            }
        }
    </script>
</body>
</html>
